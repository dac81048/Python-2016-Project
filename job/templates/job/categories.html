{% extends 'job/base.html' %}
{% block content %}
{% load static %}
<!-- datatable -->
{% if 'Admin' in request.session.dash %}
<link href="{% static 'job/js/datatables/jquery.dataTables.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'job/js/datatables/buttons.bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'job/js/datatables/fixedHeader.bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
<link href="{% static 'job/js/datatables/scroller.bootstrap.min.css' %}" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="{% static 'job/js/jquery.min.js' %}"></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/css/toastr.min.css" rel="stylesheet" />

<div class="row border-bottom white-bg page-heading">
  <div class="col-xs-12">
    <ol class="breadcrumb" style="padding:20px 15px;">
      <li>Dashboard</li>
      <li><strong>Categories</strong></li>
    </ol>
  </div>

  <div class="container" style="width:98%;">
    <div class="row">
      <div class="col-xs-12 col-sm-8 col-md-8 col-lg-8">
        <button type="button" class="btn btn-primary btn-block" data-toggle="modal" data-target="#catgories">Number of categories : {{ all_categories.count }}</button>
      </div>
      <div class="col-xs-12 col-sm-4 col-md-4 col-lg-4">
        <button type="button" class="btn btn-primary btn-block" data-toggle="modal" id="new_category" data-target="#view_result_data">Add new</button>
      </div>
      <div class="modal fade" id="catgories" role="dialog">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">Categories</h4>
            </div>
            <div class="col-md-12 col-sm-12 col-xs-12" style="padding-left: 0; padding-right: 0;">
              <div class="x_panel">
                <div class="x_content">
                  <table id="example4" class="table table-striped table-bordered dt-responsive nowrap" cellspacing="0" width="100%">
                    <thead>
                      <tr>
                        <th>Category</th>
                        <th>Employees</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for cat in all_categories %}
                        <tr>
                          <td>{{ cat.category_name  }}</td>
                          <td>{{ cat.worker_set.all.count }}</td>
                        </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row top_tiles">
      {% for cat in all_categories %}
        <div class="animated flipInY col-lg-3 col-md-3 col-sm-6 col-xs-12 category" style="cursor:pointer; margin-top:15px;" data-toggle="modal" id="{{cat.id}}" data-target="#view_result_data">
          <div class="tile-stats">
            <div class="icon"><i class="fa fa-caret-square-o-right"></i>
            </div>
            <div class="count">{{cat.worker_set.all.count}}</div>
            <h4>{{cat.category_name}}</h4>
          </div>
        </div>
      {% endfor %}
    </div>

<div class="modal fade" id="view_result_data" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal">&times;</button>
        <h4 class="modal-title">Category</h4>
      </div>
      <div class="col-md-12 col-sm-12 col-xs-12" style="padding-left: 0; padding-right: 0;">
        <div class="x_panel">
          <div id="content_result">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

{% else %}
  <h2>You have no access to this page</h2>
{% endif %}
<script src="//cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/js/toastr.min.js"></script>
<!-- Datatables-->
<script type="text/javascript" src="{% static 'job/js/datatables/jquery.dataTables.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/dataTables.bootstrap.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/dataTables.buttons.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/buttons.bootstrap.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/jszip.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/pdfmake.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/vfs_fonts.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/buttons.html5.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/buttons.print.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/dataTables.fixedHeader.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/dataTables.keyTable.min.js' %}"></script>
<script type="text/javascript" src="{% static 'job/js/datatables/dataTables.scroller.min.js' %}"></script>

<script type="text/javascript">

  window.onload = function () {
    $( ".x_panel .row .col-sm-12" ).removeClass( "col-sm-12" ).addClass( "table-responsive" );
  }

  $(document).ready(function(){
      $(".nav-tabs a").click(function(){
          $(this).tab('show');
      });
  });

  $(document).ready(function(){
    $("#new_category").on("click", function() {
      $.ajax({
        url: '/add_category/',
        type:'GET',
        data:'',
     	  success: function(data) {
          $("#content_result").html(data);
     	  }
      })
    });

    $(".category").on("click", function() {
      cat_id=this.id;
      $.ajax({
        url: '/'+cat_id+'/cat_employee/',
        type:'GET',
        data:{cat_id},
        success: function(data) {
          $("#content_result").html(data);
        }
      })
    });

    $('#example4').DataTable({
      "paging":   false,
      "info":     false
    });
    $('#datatable').dataTable();
    $('#datatable-keytable').DataTable({
      keys: true
    });
    $('#datatable-responsive').DataTable({
      "paging":   false,
      "info":     false,
      "searching": false
    });
    $('#datatable-scroller').DataTable({
      ajax: "js/datatables/json/scroller-demo.json",
      deferRender: true,
      scrollY: 380,
      scrollCollapse: true,
      scroller: true
    });
      var table = $('#datatable-fixed-header').DataTable({
        fixedHeader: true
    });
  });
</script>
{% endblock %}
